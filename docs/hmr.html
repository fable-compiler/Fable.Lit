<html class="has-navbar-fixed-top" lang="en"><head><title>Fable.Lit · Hot Reloading</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/Fable.Lit/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/Fable.Lit/">Fable.Lit</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active is-hidden-mobile" href="/Fable.Lit/docs/getting-started.html">Documentation</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/fable-compiler/Fable.Lit"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="/Fable.Lit/docs/getting-started.html">Documentation</a><a class="nacara-navbar-menu-item" href="https://github.com/fable-compiler/Fable.Lit">Github</a><a class="nacara-navbar-menu-item" href="https://twitter.com/FableCompiler">Twitter</a></div></div></nav><div class="grey-overlay"></div><div class="container"><div class="mobile-menu"><nav class="breadcrumb"><ul><li><a class="menu-trigger"><span></span><span></span><span></span></a></li><li class="is-active"><a>Documentation</a></li><li class="is-active"><a>Hot Reloading</a></li></ul></nav></div><div class="columns is-gapless is-mobile"><div class="column is-menu-column is-3-desktop is-hidden-touch"><div class="menu-container"><aside class="menu"><ul class="menu-list"><li><li><a class=" " href="/Fable.Lit/docs/getting-started.html">Getting started</a></li></li></ul><ul class="menu-list"><li><li><a class=" " href="/Fable.Lit/docs/templates.html">Templates</a></li></li></ul><ul class="menu-list"><li><li><a class=" " href="/Fable.Lit/docs/hook-components.html">Hook Components</a></li></li></ul><ul class="menu-list"><li><li><a class=" " href="/Fable.Lit/docs/web-components.html">Web Components</a></li></li></ul><ul class="menu-list"><li><li><a class=" is-active" href="/Fable.Lit/docs/hmr.html">Hot Reloading</a></li></li></ul><ul class="menu-list"><li><li><a class=" " href="/Fable.Lit/docs/testing.html">Testing</a></li></li></ul></aside></div></div><div class="column is-8-desktop is-full-touch"><section class="section"><div class="content"><header class="page-header"><div class="columns is-vcentered"><div class="column"><nav class="breadcrumb is-category-navigation is-hidden-touch"><ul><li class="is-active"><a>Documentation</a></li><li class="is-active"><a>Hot Reloading</a></li></ul></nav></div><div class="column is-narrow"><a class="button is-hidden-touch is-ghost" target="_blank" href="https://github.com/fable-compiler/Fable.Lit/edit/main/docsrc/docs/hmr.md">Edit</a></div></div><h1 class="title is-1">Hot Reloading</h1></header><div><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtki{font-style:italic}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk5{color:#e45649}.atom-one-light .mtk6{color:#986801}.atom-one-light .mtk10{color:#50a14f}.atom-one-light .mtk7{color:#a0a1a7}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk9{color:#4078f2}.atom-one-light .mtk8{color:#0184bc}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><h2 id=webpack>Webpack<a href=#webpack aria-hidden=true tabindex=-1><span class=[anchor]></span>#</a></h2><p>Webpack has been the standard to build frontend apps for a while, and it's also widely used in Fable apps. Webpack is extremely reliable and extensible, and it's still a great choice for your web app.<p>It has a couple of disadvantages however: usually requires a configuration file that can get complicated very quickly and its development server bundles your whole app for every change, which can take a few seconds in large projects.<h2 id=vite>Vite<a href=#vite aria-hidden=true tabindex=-1><span class=[anchor]></span>#</a></h2><p>A new generation of JS tooling is appearing which follow best practices by default so they require little to no configuration. Moreover, these tools include a development server that doesn't bundle your application, which makes updated much faster as the browser only need to load the modules that have changed. The most prominent examples are <a href=https://vitejs.dev>Vite</a> and <a href=https://www.snowpack.dev/>Snowpack</a>.<p>We've personally got great results with Vite. It is somewhat opinionated and thanks to this you can get a development server and build tool with zero-config by conforming to a few defaults:<ul><li>Put your static files in the <code>public</code> folder<li>Put your <code>index.html</code> in the app root (usually next to <code>package.json</code>)<li>Add a reference to the entry JS file (relative path is important):</ul><pre class="atom-one-light grvsc-container"data-index=0 data-language=html><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>&lt;</span><span class=mtk5>script</span><span class=mtk1> </span><span class=mtk6>type</span><span class=mtk1>=</span><span class=mtk10>"module"</span><span class=mtk1> </span><span class=mtk6>src</span><span class=mtk1>=</span><span class=mtk10>"./build/client/App.js"</span><span class=mtk1>>&#60/</span><span class=mtk5>script</span><span class=mtk1>></span></span></span></code></pre><p>With this you only need to install Vite and run the commands for starting the development server or bundling for production as needed.<pre class="atom-one-light grvsc-container"data-index=1 data-language=sh><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>npm i -D vite</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>npx vite --open     </span><span class="mtk7 mtki"># Start dev server and open browser</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>npx vite build      </span><span class="mtk7 mtki"># Build your site for production</span></span></span></code></pre><p>That's it, now you have an extremely fast development server and an optimized build with zero config (built files will be put in <code>dist</code> folder by default). If you need to edit some settings, you can still use a <a href=https://vitejs.dev/config/>config file</a> or the CLI options (check them with <code>npx vite --help</code>).<h2 id=fable---runfast>Fable --runFast<a href=#fable---runfast aria-hidden=true tabindex=-1><span class=[anchor]></span>#</a></h2><p>If you use <code>--runFast</code> option with Fable instead of <code>--run</code>, Vite will be started right away instead of waiting until first Fable compilation. When developing you usually already have the compiled files from the previous day, so this way you can get a development server up and running in under 200 milliseconds!<pre class="atom-one-light grvsc-container"data-index=2 data-language><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source>dotnet fable watch src -o build/client --runFast vite --open</span></span></code></pre><blockquote><p>When Fable compilation finishes Vite will just reload with the updated code.</blockquote><p>For production make sure to use <code>--run</code> so vite doesn't start bundling until Fable has finished compilation.<pre class="atom-one-light grvsc-container"data-index=3 data-language><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source>dotnet fable src -o build/client --run vite build</span></span></code></pre><h2 id=non-bundling-hmr>Non-bundling HMR<a href=#non-bundling-hmr aria-hidden=true tabindex=-1><span class=[anchor]></span>#</a></h2><p>Lit.Elmish.HMR works with non-bundling development servers like Vite or Snowpack, but with a important caveat. These dev servers do "true" Hot-Module-Replacement in the sense they only replace the updated module (remember in JS "modules" is roughly the same as "file"). However, in Elmish apps the function that triggers rendering <code>Program.run</code> is usually located in the last file. When updating any other file, the render function won't be triggered and you won't see anything changing on screen.<p>Solving this for Vite and Snowpack requires injecting special code in each module containing a component. This is usually done by plugins like <a href=https://github.com/vitejs/vite/tree/main/packages/plugin-react>React Fast Refresh</a>. Indeed you can already get a hyper-fast hot reloading experience out-of-the-box with Vite/Snowpack thanks to <a href=https://zaid-ajaj.github.io/Feliz/#/Feliz/React/StatelessComponents>Feliz ReactComponent</a>. At the time of writing, there is no such a plugin for Lit, instead Fable.Lit provides code helpers so you can control HMR at the component level.<p>First thing you need to do is to instantiate a private <em>HMR token</em> at the top of the file containing your components:<pre class="atom-one-light grvsc-container"data-index=4 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Lit</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>hmr</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> HMR.createToken</span><span class=mtk6>()</span></span></span></code></pre><p>One important thing to remember though, is that HMR in non-bundling dev servers doesn't just update the whole module (this wouldn't have any effect because other modules would still reference the old exports). In the case of Fable.Lit it will just update the render function of the component, so in order to avoid breaking dependent modules it's a good idea to put internal helpers (together with the HMR token) within a private inner module, and only expose the function components.<pre class="atom-one-light grvsc-container"data-index=5 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>module</span><span class=mtk9> </span><span class=mtk14>private</span><span class=mtk9> Util </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>hmr</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> HMR.createToken</span><span class=mtk6>()</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class="mtk7 mtki">// Other utilities here</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>open</span><span class=mtk1> </span><span class=mtk9>Util</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60HookComponent>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>MyComponent</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>..</span></span></span></code></pre><article class="is-info message"><div class=message-body><div><p>This limitation is the same as with React Fast Refresh. The main difference is with Fable.Lit you can have multiple components in the same file.</div></div></article><p>Now the only thing left is to pass the HMR token, this has to be done for each component you want to enable HMR for, and can be done with the <code>useHmr</code> hook.<pre class="atom-one-light grvsc-container"data-index=6 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk8>[&#60HookComponent>]</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>MyComponent</span><span class=mtk6>()</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    Hook.useHmr</span><span class=mtk14>(</span><span class=mtk1>hmr</span><span class=mtk14>)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>..</span></span></span></code></pre><br><p>This is a bit of a set up but it will enable a blazing fast feedback loop that is extremely valuable when you're making small UI adjustments. Also, when compiling in Release mode the HMR helpers will automatically be removed, so you don't need to worry about disabling them manually.<hr><p>If for some reason you are getting unexpected behavior with HMR, you can disable it and force a full refresh by passing <code>false</code> when creating the HMR token in a specific module.<pre class="atom-one-light grvsc-container"data-index=7 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>hmr</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> HMR.createToken</span><span class=mtk14>(</span><span class=mtk6>false</span><span class=mtk14>)</span></span></span></code></pre><blockquote><p>After passing false, you need to save <strong>twice</strong> before the full refresh kicks in.</blockquote></div></div></section><div class="section bd-docs-pagination bd-pagination-links"><a class="button bd-fat-button is-primary is-light bd-pagination-prev" href="/Fable.Lit/docs/web-components.html"><i>←</i><span class="is-hidden-mobile"><em></em><strong>Web Components</strong></span></a><a class="button bd-fat-button is-primary is-light bd-pagination-next" href="/Fable.Lit/docs/testing.html"><span class="is-hidden-mobile"><em></em><strong>Testing</strong></span><i>→</i></a></div></div></div></div><script async="" src="/Fable.Lit/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>